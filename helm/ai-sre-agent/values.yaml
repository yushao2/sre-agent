# =============================================================================
# AI SRE Agent - Helm Values
# =============================================================================
#
# Deploys:
#   - API Server (FastAPI)
#   - Celery Workers (async task processing)
#   - Celery Beat (optional scheduler)
#   - MCP Servers (Jira, Confluence, GitLab)
#   - Redis (via Bitnami subchart) OR external
#   - PostgreSQL (via Bitnami subchart) OR external
#
# =============================================================================

global:
  imageRegistry: ""
  imagePullSecrets: []
  storageClass: ""

# =============================================================================
# API Server
# =============================================================================
api:
  enabled: true
  replicaCount: 2
  
  image:
    repository: ai-sre-agent
    tag: "latest"
    pullPolicy: IfNotPresent
  
  resources:
    limits:
      cpu: "1"
      memory: 1Gi
    requests:
      cpu: 250m
      memory: 256Mi
  
  service:
    type: ClusterIP
    port: 8000
  
  ingress:
    enabled: false
    className: nginx
    annotations: {}
    hosts:
      - host: sre-agent.example.com
        paths:
          - path: /
            pathType: Prefix
    tls: []
  
  autoscaling:
    enabled: false
    minReplicas: 2
    maxReplicas: 10
    targetCPUUtilizationPercentage: 70
  
  podAnnotations: {}
  nodeSelector: {}
  tolerations: []
  affinity: {}

# =============================================================================
# Celery Workers
# =============================================================================
worker:
  enabled: true
  replicaCount: 2
  
  image:
    repository: ai-sre-agent
    tag: "latest"
    pullPolicy: IfNotPresent
  
  # Celery settings
  concurrency: 4
  queues: "llm"
  logLevel: "info"
  
  resources:
    limits:
      cpu: "2"
      memory: 4Gi
    requests:
      cpu: 500m
      memory: 1Gi
  
  autoscaling:
    enabled: false
    minReplicas: 2
    maxReplicas: 20
    targetCPUUtilizationPercentage: 60
  
  podAnnotations: {}
  nodeSelector: {}
  tolerations: []
  affinity: {}

# =============================================================================
# Celery Beat Scheduler
# =============================================================================
beat:
  enabled: false
  
  image:
    repository: ai-sre-agent
    tag: "latest"
    pullPolicy: IfNotPresent
  
  resources:
    limits:
      cpu: 200m
      memory: 256Mi
    requests:
      cpu: 50m
      memory: 64Mi

# =============================================================================
# MCP Servers
# =============================================================================
mcpServers:
  jira:
    enabled: true
    replicaCount: 2
    image:
      repository: ai-sre-agent
      tag: "latest"
      pullPolicy: IfNotPresent
    resources:
      limits:
        cpu: 500m
        memory: 512Mi
      requests:
        cpu: 100m
        memory: 128Mi
    service:
      port: 8080
  
  confluence:
    enabled: true
    replicaCount: 2
    image:
      repository: ai-sre-agent
      tag: "latest"
      pullPolicy: IfNotPresent
    resources:
      limits:
        cpu: 500m
        memory: 512Mi
      requests:
        cpu: 100m
        memory: 128Mi
    service:
      port: 8080
  
  gitlab:
    enabled: true
    replicaCount: 2
    image:
      repository: ai-sre-agent
      tag: "latest"
      pullPolicy: IfNotPresent
    resources:
      limits:
        cpu: 500m
        memory: 512Mi
      requests:
        cpu: 100m
        memory: 128Mi
    service:
      port: 8080

# =============================================================================
# Redis (Bitnami Subchart)
# =============================================================================
redis:
  # Set to true to deploy Redis via subchart
  enabled: true
  
  # Architecture: standalone or replication
  architecture: standalone
  
  auth:
    enabled: true
    password: ""  # Auto-generated if empty
    existingSecret: ""
    existingSecretPasswordKey: "redis-password"
  
  master:
    persistence:
      enabled: true
      size: 8Gi
    resources:
      limits:
        cpu: 500m
        memory: 512Mi
      requests:
        cpu: 100m
        memory: 128Mi

# External Redis (when redis.enabled=false)
externalRedis:
  host: ""
  port: 6379
  password: ""
  existingSecret: ""
  existingSecretPasswordKey: "redis-password"
  # Full URL (overrides host/port)
  # url: "redis://:password@host:6379/0"

# =============================================================================
# PostgreSQL (Bitnami Subchart)
# =============================================================================
postgresql:
  # Set to true to deploy PostgreSQL via subchart
  enabled: true
  
  auth:
    username: sre_agent
    password: ""  # Auto-generated if empty
    database: sre_agent
    existingSecret: ""
  
  primary:
    persistence:
      enabled: true
      size: 20Gi
    resources:
      limits:
        cpu: "1"
        memory: 1Gi
      requests:
        cpu: 250m
        memory: 256Mi

# External PostgreSQL (when postgresql.enabled=false)
externalPostgresql:
  host: ""
  port: 5432
  username: sre_agent
  password: ""
  database: sre_agent
  existingSecret: ""
  existingSecretPasswordKey: "postgresql-password"
  # Full URL (overrides individual settings)
  # url: "postgresql://user:pass@host:5432/db"

# =============================================================================
# Secrets
# =============================================================================
secrets:
  # Create secret from values (testing only - use existingSecret in production)
  create: false
  
  # Anthropic API
  anthropicApiKey: ""
  
  # Jira
  jira:
    url: ""
    username: ""
    apiToken: ""
  
  # Confluence
  confluence:
    url: ""
    username: ""
    apiToken: ""
  
  # GitLab
  gitlab:
    url: "https://gitlab.com"
    token: ""
  
  # Use existing secret (recommended)
  existingSecret: ""
  # Expected keys:
  #   ANTHROPIC_API_KEY
  #   JIRA_URL, JIRA_USERNAME, JIRA_API_TOKEN
  #   CONFLUENCE_URL, CONFLUENCE_USERNAME, CONFLUENCE_API_TOKEN
  #   GITLAB_URL, GITLAB_TOKEN

# =============================================================================
# Common Settings
# =============================================================================
serviceAccount:
  create: true
  name: ""
  annotations: {}

podSecurityContext:
  runAsNonRoot: true
  runAsUser: 1000
  fsGroup: 1000

securityContext:
  allowPrivilegeEscalation: false
  readOnlyRootFilesystem: true
  capabilities:
    drop: ["ALL"]

networkPolicy:
  enabled: false

podDisruptionBudget:
  enabled: true
  minAvailable: 1
